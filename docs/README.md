
![][LOGO]


# Introduction

Wave goodbye to [output parameters][OUTPUT_PARAMETERS], [sentinel values][SENTINEL_VALUE], and endless
[null checking][NULL_CHECKING]! Embrace clean, efficient error handling today by encapsulating operations that may
succeed or fail in a type-safe way.

<div class="features" markdown="1">

- <img src="tachometer-alt.svg" width="64">
  **Boost Performance**
  Fewer pointer dereferences; rely on optimized single return values
- <img src="tint.svg" width="64">
  **Simple API**
  Handle success and failure scenarios with just a handful of C macros
- <img src="bolt.svg" width="64">
  **Streamlined Error Handling**
  Reduce the chances of incorrect or inconsistent error handling
- <img src="shield-alt.svg" width="64">
  **Safe Execution**
  Enforce valid states, eliminating risks like dangling pointers or stale data
- <img src="glasses.svg" width="64">
  **Enhanced Readability**
  Reduce boilerplate code to make your code easier to understand
- <img src="filter.svg" width="64">
  **Functional Style**
  Avoid side effects and encourage pure, composable functions
- <img src="feather-alt.svg" width="64">
  **Lightweight**
  Keep your project slim with no extra dependencies
- <img src="balance-scale.svg" width="64">
  **Open Source**
  Enjoy transparent, permissive Apache 2 licensing
- <img src="curly-braces.svg" width="64">
  **Header-Only C Library**
  Compatible with C23 standard and modern compilers

</div>

> [!TIP]
> This library provides a cleaner, safer, and more modern approach to error handling by combining function result and
> error into a unified return value. It enforces correct usage at the call site, reduces the risk of bugs, and leads to
> more maintainable and extensible code.

## TL;DR

Not a fan of reading long docs? No worries! Tune in to *Deep Dive*, a podcast generated by [NetbookLM][NETBOOKLM]. In
just a few minutes, you'll get the essential details and a fun intro to what this library can do for you!

@htmlinclude deep-dive.html

## Results in a Nutshell

Result objects represent the outcome of an operation, removing the need for *output parameters* and *null checking*.
Operations that succeed produce results encapsulating a *success* value; operations that fail produce results with a
*failure* value. Success and failure can be represented by whatever types make the most sense for each operation.

Let's use a *pet store* example to show how this library can simplify your code.

Start by defining some data types to represent pets.

@snippet pet-store.h types

Next, let's say you have an array of pets acting as your "database".

@snippet pet-store.c array

> [!NOTE]
> You'll use a function, `find_pet(id)`, to retrieve pets by their ID. We'll skip its implementation for now.

Suppose you need to write a function to get a pet's status.

![][EXAMPLE_EARLY_ATTEMPT]

> [!WARNING]
> This works... until someone passes an invalid ID. If `find_pet` returns `NULL`, your code could crash unexpectedly.

To fix this, you refactor the function to return an error code and use a pointer to "return" the status.

![][EXAMPLE_USING_POINTERS]

It's safer, but also clunky.

> [!WARNING]
> What if the pointer is `NULL`? Should you return a new error code? Use `assert`? It's starting to feel messy.

Instead of juggling pointers and error codes, **you should return a Result object**.

![][EXAMPLE_USING_RESULTS]

> [!TIP]
> The result encapsulates both success (pet status) and failure (error code) in one clean package. The caller
> immediately knows the function can fail, and you've eliminated the need for a pointer. This is simpler, safer, and
> much easier to read.

Encouraged, you refactor `find_pet` to return a failed result instead of `NULL` when a pet isn't found. Now,
`get_pet_status` can rely on `find_pet` to handle errors and focus on the happy path.

![][EXAMPLE_EMBRACING_RESULTS]

> [!NOTE]
> And just like that, your code becomes robust and maintainable. No more mysterious crashes, no awkward pointer checks.
> Just clean, elegant error handling.

With Results, handling success and failure feels natural, leaving you free to focus on the fun parts of coding.


# Getting Started

## Adding Results to Your Project

This library consists of one header file only. All you need to do is copy `result.h` into your project, and include it.

```c
#include "result.h"
```

Since it's a header-only library, there is no library code to link against.

## Result Types and Variables

- #RESULT_STRUCT @copybrief RESULT_STRUCT
  @snippet example.c result_struct
- #RESULT @copybrief RESULT
  @snippet example.c result

## Creating Result Objects

- #RESULT_SUCCESS @copybrief RESULT_SUCCESS
  @snippet example.c result_success
- #RESULT_FAILURE @copybrief RESULT_FAILURE
  @snippet example.c result_failure


# Basic Usage

## Checking Success or Failure

- #RESULT_HAS_SUCCESS @copybrief RESULT_HAS_SUCCESS
  @snippet example.c result_has_success
- #RESULT_HAS_FAILURE @copybrief RESULT_HAS_FAILURE
  @snippet example.c result_has_failure

## Unwrapping Values

- #RESULT_USE_SUCCESS @copybrief RESULT_USE_SUCCESS
  @snippet example.c result_use_success
- #RESULT_USE_FAILURE @copybrief RESULT_USE_FAILURE
  @snippet example.c result_use_failure
- #RESULT_GET_SUCCESS @copybrief RESULT_GET_SUCCESS
  @snippet example.c result_get_success
- #RESULT_GET_FAILURE @copybrief RESULT_GET_FAILURE
  @snippet example.c result_get_failure
- #RESULT_OR_ELSE @copybrief RESULT_OR_ELSE
  @snippet example.c result_or_else
- #RESULT_OR_ELSE_MAP @copybrief RESULT_OR_ELSE_MAP
  @snippet example.c result_or_else_map

## Conditional Actions

- #RESULT_IF_SUCCESS @copybrief RESULT_IF_SUCCESS
  @snippet example.c result_if_success
- #RESULT_IF_FAILURE @copybrief RESULT_IF_FAILURE
  @snippet example.c result_if_failure
- #RESULT_IF_SUCCESS_OR_ELSE @copybrief RESULT_IF_SUCCESS_OR_ELSE
  @snippet example.c result_if_success_or_else


# Advanced Usage

## Screening Results

- #RESULT_FILTER @copybrief RESULT_FILTER
  @snippet example.c result_filter
- #RESULT_FILTER_MAP @copybrief RESULT_FILTER_MAP
  @snippet example.c result_filter_map
- #RESULT_RECOVER @copybrief RESULT_RECOVER
  @snippet example.c result_recover
- #RESULT_RECOVER_MAP @copybrief RESULT_RECOVER_MAP
  @snippet example.c result_recover_map

## Transforming Values

- #RESULT_MAP_SUCCESS @copybrief RESULT_MAP_SUCCESS
  @snippet example.c result_map_success
- #RESULT_MAP_FAILURE @copybrief RESULT_MAP_FAILURE
  @snippet example.c result_map_failure
- #RESULT_MAP @copybrief RESULT_MAP
  @snippet example.c result_map
- #RESULT_FLAT_MAP_SUCCESS @copybrief RESULT_FLAT_MAP_SUCCESS
  @snippet example.c result_flat_map_success
- #RESULT_FLAT_MAP_FAILURE @copybrief RESULT_FLAT_MAP_FAILURE
  @snippet example.c result_flat_map_failure
- #RESULT_FLAT_MAP @copybrief RESULT_FLAT_MAP
  @snippet example.c result_flat_map


# Additional Info

This library relies on modern C features such as [designated initializers][DESIGNATED_INITIALIZERS],
[compound literals][COMPOUND_LITERALS], and [typeof][TYPEOF].

## Source Code

The source code is [available on GitHub][SOURCE_CODE].

## Author

Copyright 2024 [Guillermo Calvo][AUTHOR].

[![][GUILLERMO_IMAGE]][GUILLERMO]

## License

This library is licensed under the *Apache License, Version 2.0* (the "License");
you may not use it except in compliance with the License.

You may obtain a copy of the License at <http://www.apache.org/licenses/LICENSE-2.0>

Unless required by applicable law or agreed to in writing, software distributed under the License
is distributed on an "AS IS" BASIS, **WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND**, either express or implied.

See the License for the specific language governing permissions and limitations under the License.


**Permitted:**

- **Commercial Use**: You may use this library and derivatives for commercial purposes.
- **Modification**: You may modify this library.
- **Distribution**: You may distribute this library.
- **Patent Use**: This license provides an express grant of patent rights from contributors.
- **Private Use**: You may use and modify this library without distributing it.

**Required:**

- **License and Copyright Notice**: If you distribute this library you must include a copy of the license and copyright
  notice.
- **State Changes**: If you modify and distribute this library you must document changes made to this library.

**Forbidden:**

- **Trademark use**: This license does not grant any trademark rights.
- **Liability**: The library author cannot be held liable for damages.
- **Warranty**: This library is provided without any warranty.


[AUTHOR]:                       https://github.com/guillermocalvo/
[COMPOUND_LITERALS]:            https://gcc.gnu.org/onlinedocs/gcc-3.3/gcc/Compound-Literals.html
[DESIGNATED_INITIALIZERS]:      https://gcc.gnu.org/onlinedocs/gcc-3.3/gcc/Designated-Inits.html
[EXAMPLE_EARLY_ATTEMPT]:        docs/early-attempt.png
[EXAMPLE_EMBRACING_RESULTS]:    docs/embracing-results.png
[EXAMPLE_USING_POINTERS]:       docs/using-pointers.png
[EXAMPLE_USING_RESULTS]:        docs/using-results.png
[GUILLERMO]:                    https://guillermo.dev/
[GUILLERMO_IMAGE]:              https://guillermo.dev/assets/images/thumb.png
[NETBOOKLM]:                    https://notebooklm.google.com/
[LOGO]:                         docs/result-logo.svg
[NULL_CHECKING]:                https://en.wikipedia.org/wiki/Nullable_type#Compared_with_null_pointers
[OUTPUT_PARAMETERS]:            https://en.wikipedia.org/wiki/Parameter_(computer_programming)#Output_parameters
[SENTINEL_VALUE]:               https://en.wikipedia.org/wiki/Sentinel_value
[SOURCE_CODE]:                  https://github.com/guillermocalvo/resultlib
[TYPEOF]:                       https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2899.htm
